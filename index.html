
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/12/12096.png" type="image/png">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>axaxpoisk</title>
    <style>
        .tooltip {
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            z-index: 999;
            max-width: 200px;
        }
    body {
        background-color: black;
        color: rgb(204, 123, 17);
        margin: 0;

    }

    #movieContainer {
        max-width: 100%; 
    }

    #filmName {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    #detailedFilmName {
        font-size: 18px;
        margin-bottom: 10px;
    }

        #detailedFilmName {
            font-size: 24px;
            font-weight: bold;
            font-style: inherit;
        }
        #description {
            font-size: 18px;
            font-style: inherit;
            max-width: 600;
            color: rgb(217, 231, 19);
        }
        #shortdescription {
            font-size: 18px;
            font-style: inherit;
            max-width: 600;
            color: rgb(24, 209, 169);
        }
        #year {
            font-size: 18px;
            font-style: inherit;
            max-width: 600;
            color: rgb(228, 12, 12)
        }
        #slogan {
            font-size: 18px;
            font-style: inherit;
            max-width: 600;
            color: rgb(21, 206, 36)
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #000000;
            margin: 0;
       
        }

        #movieBlok {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        .movie {
            margin: 10px;
            padding: 10px;
            background-color: #000000;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            
        }

        .movie img {
            max-width: 100px;
            height: auto;
            border-radius: 5px;
        }
        
        .movie p {
            margin: 10px 0 0;
        }
    </style>
</head>

<body>
    
    <div id="filmName"></div>
    <input type="text" id="movieIdInput" placeholder="ID s kinopoiska" inputmode="numeric" pattern="[0-9]*">
    <button onclick="getMovieData()">view</button>
    <div id="detailedFilmName"></div>
    <div id="movieContainer"></div>
    <div id="year"></div>
    <br><div id="shortdescription"></div></br>
    <div id="description"></div>
   <br> <div id="slogan"></div></br>
   <div id="movieBlok"></div>

    <script>
        const apiKey = 'c20595a1-3d8c-4cbd-92eb-fd7b0fa75c67';
        $(document).ready(function () {
            // Load movie from URL when the page loads
            loadMovieFromURL();
        });

        function loadMovieFromURL() {
            const movieIdFromURL = getParameterByName('');
            if (movieIdFromURL) {
                $('#movieIdInput').val(movieIdFromURL);
                getMovieData();
            }
        }

        function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

        function getMovieData() {
    const movieIdValue = $('#movieIdInput').val();
    const newUrl = `?=${movieIdValue}`;

    // Update the URL without triggering a page reload
    window.history.pushState({ path: newUrl }, '', newUrl);

    // Reload the page or trigger navigation to the new URL
    // window.location.href = newUrl;  // Uncomment this line if you want to reload the page

    $.ajax({
        url: 'https://w3w.kpfr.cc/kinobox/index.php',
        crossDomain: true,
        data: {
            'kinopoisk': movieIdValue
        }
    }).done(function (response) {
        console.log(response);

        if (response.data && response.data.length > 0) {
            const iframeUrl = response.data[0].iframeUrl;
            const movieId = extractMovieId(iframeUrl);
            const filmName = response.data[0].nameRu;

            viewMovie(movieId);
            displayFilmName(filmName);
            getMovieDetails(movieIdValue);
            getSimilarMovies(movieIdValue);
        } else {
            console.error('No movie data found');
        }
    });
}

        function extractMovieId(iframeUrl) {
            const urlParts = iframeUrl.split('/');
            return urlParts[urlParts.length - 1];
        }

        function viewMovie(movieId) {
            const iframeUrl = `https://api.embr.ws/embed/movie/${movieId}`;
            const iframe = `<iframe src="${iframeUrl}" width="600" height="450" frameborder="0" allowfullscreen></iframe>`;
            document.getElementById('movieContainer').innerHTML = iframe;
        }

        function displayFilmName(filmName) {
            document.getElementById('filmName')
        }

        function getMovieDetails(movieId) {
            $.ajax({
                url: `https://kinopoiskapiunofficial.tech/api/v2.2/films/${movieId}`,
                crossDomain: true,
                headers: {
                    'x-api-key': apiKey
                },
                contentType: 'application/json'
            }).done(function (response) {
                console.log(response);
                const detailedFilmName = response.nameRu;
                const description = response.description;
                const year = response.year;
                const slogan = response.slogan;
                const shortdescription = response.shortDescription;
                displayDetailedFilmName(detailedFilmName);
                displaydescription(description);
                displayyear(year);
                displayslogan(slogan);
                displayshortdescription(shortdescription);
            });
        }

        function displayDetailedFilmName(detailedFilmName) {
    const element = document.getElementById('detailedFilmName');
    if (detailedFilmName !== null) {
        element.innerHTML = `${detailedFilmName}`;
    } else {
        element.innerHTML = ''; // Set the content to an empty string
    }
}

function displaydescription(description) {
    const element = document.getElementById('description');
    if (description !== null) {
        element.innerHTML = `${description}`;
    } else {
        element.innerHTML = '';
    }
}

function displayyear(year) {
    const element = document.getElementById('year');
    if (year !== null) {
        element.innerHTML = `${year}`;
    } else {
        element.innerHTML = '';
    }
}

function displayslogan(slogan) {
    const element = document.getElementById('slogan');
    if (slogan !== null) {
        element.innerHTML = `${slogan}`;
    } else {
        element.innerHTML = '';
    }
}

function displayshortdescription(shortdescription) {
    const element = document.getElementById('shortdescription');
    if (shortdescription !== null) {
        element.innerHTML = `${shortdescription}`;
    } else {
        element.innerHTML = '';
    }
}

        $(document).ready(function () {
            getSimilarMovies();
        });
        function getSimilarMovies(movieId) {
    const apiUrl = `https://kinopoiskapiunofficial.tech/api/v2.2/films/${movieId}/similars`;

    $.ajax({
        url: apiUrl,
        headers: {
            'X-API-KEY': apiKey,
            'Content-Type': 'application/json'
        },
        success: function (response) {
            displaySimilarMovies(response.items);
        },
        error: function (error) {
            console.error('Error fetching data:', error);
        }
    });
}
    
function displaySimilarMovies(items) {
    const movieBlok = $('#movieBlok');

    // Clear existing content in the movieBlok
    movieBlok.empty();

    items.forEach(function (item) {
        const nameRu = item.nameRu;
        const posterUrl = item.posterUrl;
        const filmId = item.filmId

        // Create HTML elements to display movie information
        const movieElement = $('<div>').addClass('movie');
        const nameElement = $('<p>').text(nameRu);
        const filmElement = $('<p>').text(filmId);
        const posterElement = $('<img>').attr('src', posterUrl);

        // Add hover effects to make it look clickable
        posterElement.hover(
            function() {
                $(this).css({'cursor': 'pointer', 'transform': 'scale(1.1)'});
            },
            function() {
                $(this).css({'cursor': 'auto', 'transform': 'scale(1)'});
            }
        );

        // Add click event listener to the posterElement
        posterElement.click(function (event) {
    // Check if the Ctrl key is pressed (you can change 'Ctrl' to 'Shift', 'Alt', etc.)
    if (!event.ctrlKey) {
        // Navigate to the movie details page without opening a new tab
        window.location.href = 'index.html?=' + filmId; // Replace with the actual URL or route to your movie details page
    }
});

// Open the movie details page in a new tab when right-clicking on the image
posterElement.on('contextmenu', function (event) {
    const movieDetailsUrl = 'index.html?=' + filmId; // Replace with the actual URL or route to your movie details page
    window.open(movieDetailsUrl);
});

        // Append elements to the container
        movieElement.append(posterElement, nameElement, filmElement);
        movieBlok.append(movieElement);
    });
}

function handleUrlChange() {
    loadMovieFromURL();
}

// Call the function on initial page load
handleUrlChange();

// Call the function when the URL changes
$(window).on('popstate', handleUrlChange);
// Add click event listener to the posterElement

    </script>
</body>

</html>
