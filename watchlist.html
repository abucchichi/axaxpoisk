<!DOCTYPE html>
<html lang="ru">

<head>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/12/12096.png" type="image/png">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchlist</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<style>
        #watchlist {
            margin: 10px;
            padding: 10px;
            background-color: #000000;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            margin-top: 20px;
            
        }

        .watchlist-item {
            margin: 5px;
            padding: 5px;
            background-color: #000000;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            width: 150px;
            text-align: center;
            color: #fff;
        }
        .watchlist-item:hover {
            transform: scale(1.05); /* Increase the size on hover */
            box-shadow: 0 0 15px #afeeee; /* Add glow effect on hover */
        }
        .watchlist-item img {
            max-width: 100%;
            border-radius: 5px;
            height: auto;
        }
        
        .watchlist-item a {
            text-decoration: none;
            color: #afeeee;
            font-family: Arial, sans-serif;
        }
        #username, #password {
margin-top: 10px;
background-color: #000000;
max-width: 100px;
height: 10px;
padding: 10px;
margin-left: 2px;
color: rgb(0, 255, 255);
/* text-align: center; */
border: 1px solid #afeeee;
border-radius: 10px;
/* box-shadow: 3px 3px 2px rgb(249, 255, 85); */

}
#butt {
color: #afeeee;
border: 1px solid #afeeee;
border-radius: 10px;
padding: 5px 10px;
background: transparent;
height: 30px;

}

#butt:hover {
box-shadow: 2px 2px 55px #afeeee inset;
}

#butt:active {
box-shadow: 2px 2px 55px #afeeee inset;
}
</style>
<body>
    
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button id="butt" onclick="register()">Register</button>
    <button id="butt" onclick="login()">Login</button>
    <h2>watchlist</h2>
    <div id="watchlist"></div>
    <script>


        async function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            await fetch(`${API_URL}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            alert("registered");
            login(username, password);
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const response = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            const data = await response.json();
            localStorage.setItem('token', data.token);
            goToWatchlist();
        }



    </script>
    <script>
        
        const API_URL = 'https://api-nu-lilac.vercel.app';
        const apiKey = 'c20595a1-3d8c-4cbd-92eb-fd7b0fa75c67';

        async function getWatchlist() {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_URL}/watchlist`, {
                method: 'GET',
                headers: { 'Authorization': token }
            });
            return await response.json();
        }

        async function displayWatchlist() {
    const watchlist = await getWatchlist();
    const watchlistDiv = document.getElementById('watchlist');
    watchlistDiv.innerHTML = ''; // Clear previous content

    // Reverse the order of the watchlist
    const reversedWatchlist = watchlist.slice().reverse();

    // Fetch and display movie details
    for (const movieId of reversedWatchlist) {
        const movieDetails = await getMovieDetails(movieId);
        const movieLink = `<a href="index.html?=${movieId}">${movieDetails.nameRu}</a>`;
        const movieImg = `<a href="index.html?=${movieId}"><img src="${movieDetails.posterUrl}" alt="${movieDetails.nameRu}" style="max-width: 100px;"></a>`;
        watchlistDiv.innerHTML += `<div class="watchlist-item">${movieImg}<br>${movieLink}</div>`;
    }
}

async function getMovieDetails(movieId) {
    const response = await fetch(`https://kinopoiskapiunofficial.tech/api/v2.2/films/${movieId}`, {
        headers: {
            'X-API-KEY': apiKey
        }
    });
    return await response.json();
}


        async function getMovieDetails(movieId) {
            const response = await fetch(`https://kinopoiskapiunofficial.tech/api/v2.2/films/${movieId}`, {
                headers: { 'X-API-KEY': apiKey }
            });
            return await response.json();
        }

        // Call displayWatchlist on page load if user is logged in
        window.onload = function() {
            const token = localStorage.getItem('token');
            if (token) {
                displayWatchlist();
            } else {
                // window.location.href = 'index.html';
            }
        }
    </script>
</body>

</html>
